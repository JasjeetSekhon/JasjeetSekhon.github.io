<html><head><title>R: Multinomial Robust Estimation</title>
<link rel="stylesheet" type="text/css" href="../../R.css">
</head><body>

<table width="100%" summary="page for Robust Multinomial Regression {multinomRob}"><tr><td>Robust Multinomial Regression {multinomRob}</td><td align="right">R Documentation</td></tr></table>
<h2>Multinomial Robust Estimation</h2>


<h3>Description</h3>

<p>
<code>multinomRob</code> fits the overdispersed multinomial regression model
for grouped count data using the hyperbolic tangent (tanh) and least quartile
difference (LQD) robust estimators.
</p>


<h3>Usage</h3>

<pre>
  multinomRob(model, data, starting.values=NULL,  equality=NULL,
              genoud.parms=NULL, print.level=0, iter = FALSE,
              maxiter = 10, multinom.t=1, multinom.t.df=NA)
</pre>


<h3>Arguments</h3>

<table summary="R argblock">
<tr valign="top"><td><code>model</code></td>
<td>
The regression model specification.  This is a list of formulas, with one
formula for each category of outcomes for which counts have been measured
for each observation.  For example, in the following,
<br>
<code>model=list(y1 ~ x1, y2 ~ x2, y3 ~ 0)</code>
<br>
the outcome variables containing counts are <code>y1</code>, <code>y2</code> and
<code>y3</code>, and the linear predictor for <code>y1</code> is a coefficient times
<code>x1</code> plus a constant, the linear predictor for <code>y2</code> is a
coefficient times <code>x2</code> plus a constant, and the linear predictor for
<code>y3</code> is zero.  Each formula has the format <code>countvar ~ RHS</code>,
where <code>countvar</code> is the name of a vector, in the dataframe referenced
by the <code>data</code> argument, that gives the counts for all observations
for one category.  <code>RHS</code> denotes the righthand side of a formula using
the usual syntax for formulas, where each variable in the formula is the
name of a vector in the dataframe referenced by the <code>data</code> argument.
For example, a <code>RHS</code> specification of <code>var1 + var2*var3</code> would
specify that the regressors are to be <code>var1</code>, <code>var2</code>,
<code>var3</code>, the terms generated by the interaction <code>var2:var3</code>, and
the constant.
<br>
The set of outcome alternatives may be specified to vary over observations,
by putting in a negative value for alternatives that do not exist for
particular observations.  If the value of an outcome variable is negative
for an observation, then that outcome is considered not available for that
observation.  The predicted counts for that observation are defined only
for the available observations and are based on the linear predictors for
the available observations.  The same set of coefficient parameter values
are used for all observations.  Any observation for which fewer than two
outcomes are available is omitted.
<br>
Observations with missing data (<code>NA</code>) in any outcome variable or
regressor are omitted (listwise deletion).
<br>
In a model that has the same regressors for every category, except for
one category for which there are no regressors in order to identify the
model (the reference category), the <code>RHS</code> specification must be
given for all the categories except the reference category.  The formula
for the reference category must include a <code>RHS</code> specification that
explicitly omits the constant, e.g., <code>countvar ~ -1</code> or
<code>countvar ~ 0</code>.  The number of coefficient parameters to be
estimated equals the number of terms generated by all the formulas,
subject to equality constraints that may be specified using the
<code>equality</code> argument.</td></tr>
<tr valign="top"><td><code>data</code></td>
<td>
The dataframe that contains all the variables referenced in the
<code>model</code> argument, which are the data to be analyzed.</td></tr>
<tr valign="top"><td><code>starting.values</code></td>
<td>
Starting values for the regression coefficient parameters, as a vector.
The parameter ordering matches the ordering of the formulas in the
<code>model</code> argument:  parameters for the terms in the first formula
appear first, then come parameters for the terms in the second formula,
etc.  In practice it will usually be better to start by letting
multinomRob find starting values by using the <code>multinom.t</code> option,
then using the results from one run as starting values for a subsequent
run done with, perhaps, a larger population of operators for rgenoud.</td></tr>
<tr valign="top"><td><code>equality</code></td>
<td>
List of equality constraints.  This is a list of lists of
formulas.  Each formula has the same format as in the model specification,
and must include only a subset of the outcomes and regressors used in the
model specification formulas.  All the coefficients specified by the
formulas in each list will be constrained to have the same value during
estimation.  For example, in the following,
<br>
<code>multinomRob(model=list(y1 ~ x1, y2 ~ x2, y3 ~ 0), data=dtf,
      equality=list(list(y1 ~ x1 + 0, y2 ~ x2 + 0)) );</code>
<br>
the model to be estimated is
<br>
<code>list(y1 ~ x1, y2 ~ x2, y3 ~ 0)</code>
<br>
and the coefficients of x1 and x2 are constrained equal by
<br>
<code>equality=list(list(y1 ~ x1 + 0, y2 ~ x2 + 0))</code>
<br>
In the equality formulas it is necessary to say <code>+ 0</code> so the
intercepts are not involved in the constraints.  If a parameter occurs
in two different lists in the <code>equality=</code> argument, then all the
parameters in the two lists are constrained to be equal to one
another.  In the output this is described as consolidating the lists.</td></tr>
<tr valign="top"><td><code>genoud.parms</code></td>
<td>
List of named arguments used to control the rgenoud optimizer, which is
used to compute the LQD estimator.</td></tr>
<tr valign="top"><td><code>print.level</code></td>
<td>
Specify 0 for minimal printing, 1 to print more detailed information
about LQD and other intermediate computations, 2 to print details about
the tanh computations, or 3 to print details about starting values
computations.</td></tr>
<tr valign="top"><td><code>iter</code></td>
<td>
<code>TRUE</code> means to iterate between LQD and tanh estimation steps until
either the algorithm converges, the number of iterations specified by the
<code>maxiter</code> argument is reached, or if an LQD step occurs that
produces a larger value than the previous step did for the overdispersion
scale parameter.  This option is often improves the fit of the model.</td></tr>
<tr valign="top"><td><code>maxiter</code></td>
<td>
The maximum number of iterations to be done between LQD and tanh
estimation steps.</td></tr>
<tr valign="top"><td><code>multinom.t</code></td>
<td>
<code>1</code> means use the multinomial multivariate-t model to compute
starting values for the coefficient parameters.  But if the MNL
results are better (as judged by the LQD fit), MNL values will be
used instead.  <code>0</code> means use nonrobust maximum likelihood
estimates for a multinomial regression
model.  <code>2</code> forces the use of the multivariate-t model for
starting values even if the MNL estimates provide better starting
values for the LQD.  Note that with <code>multinom.t=1</code> or <code>multinom.t=2</code>,
multivariate-t
starting values will not be used if the model cannot generate valid
standard errors.  To force the use of multivariate-t estimates even
in this circumstance, see the <code>multinom.t.df</code> argument.
<br>
If the <code>starting.values</code> argument is not
<code>NULL</code>, the starting values given in that argument are used and the <code>multinom.t</code>
argument is ignored.  Multinomial multivariate-t starting values are
not available when the number
of outcome alternatives varies over the observations.</td></tr>
<tr valign="top"><td><code>multinom.t.df</code></td>
<td>
<code>NA</code> means that the degrees of freedom (DF) for the multivariate-t
model (when used) should be estimated.  If <code>multinom.t.df</code> is a number,
that number will be used for the degrees of freedom and the DF will not be
estimated.  Only a positive number should be used.
Setting <code>multinom.t.df</code> to a number also implies that, if
<code>multinom.t=1</code> or <code>multinom.t=2</code>, the
multivariate-t starting values will be used (depending on the comparison with
the MNL estimates if <code>multinom.t=1</code> is set) even if the standard
errors are not defined.
</td></tr>
</table>

<h3>Details</h3>

<p>
The tanh estimator is a redescending
M-estimator, and the LQD estimator is a generalized S-estimator.  The LQD
is used to estimate the scale of the overdispersion.  Given that scale
estimate, the tanh estimator is used to estimate the coefficient parameters
of the linear predictors of the multinomial regression model. <br>
</p>
<p>
If starting
values are not supplied, they are computed using a multinomial
multivariate-t model.  The program also computes and reports nonrobust
maximum likelihood estimates for the multinomial regression model,
reporting sandwich estimates for the standard errors that are adjusted for
a nonrobust estimate of the error dispersion.
</p>


<h3>Value</h3>

<p>
multinomRob returns a list of 15 objects.  The returned objects are:
</p>
<table summary="R argblock">
<tr valign="top"><td><code>coefficients</code></td>
<td>
The tanh coefficient estimates in matrix format.  The matrix has one
column for each formula specified in the <code>model</code> argument.  The
name of each column is the name used for the count variable in the
corresponding formula.  The label for each row of the matrix gives the
names of the regressors to which the coefficient values in the row
apply.  The regressor names in each label are separated by a forward
slash (/), and <code>NA</code> is used to denote that no regressor is
associated with the corresponding value in the matrix.  The value 0 is
used in the matrix to fill in for values that do not correspond to a
<code>model</code> formula regressor.</td></tr>
<tr valign="top"><td><code>se</code></td>
<td>
The tanh coefficient estimate standard errors in matrix format.  The
format and labelling used for the matrix is the same as is used for the
<code>coefficients</code>.  The standard errors are derived from the estimated
asymptotic sandwich covariance estimate.</td></tr>
<tr valign="top"><td><code>LQDsigma2</code></td>
<td>
The LQD dispersion (variance) parameter estimate.  This is the LQD estimate of
the scale value, squared.</td></tr>
<tr valign="top"><td><code>TANHsigma2</code></td>
<td>
The tanh dispersion parameter estimate.</td></tr>
<tr valign="top"><td><code>weights</code></td>
<td>
The matrix of tanh weights for the orthogonalized residuals.  The matrix
has one row for each observation in the data and as many columns as
there are formulas specified in the <code>model</code> argument.  The first
column of the matrix has names for the observations, and the remaining
columns contain the weights.  Each of the latter columns has a name
derived from the name of one of the count variables named in the
<code>model</code> argument.  If <code>count1</code> is the name of the count
variable used in the first formula, then the second column in the matrix
is named <code>weights:count1</code>, etc.
<br>
If an observation has negative values specified for some outcome variables,
indicating that those outcome alternatives are not available for that
observation, then values of <code>NA</code> appear in the weights matrix for that
observation, as many <code>NA</code> values as there are unavailable
alternatives.  The <code>NA</code> values will be the last values in the affected
row of the weights matrix, regardless of which outcome alternatives were
unavailable for the observation.</td></tr>
<tr valign="top"><td><code>Hdiag</code></td>
<td>
Weights used to fully studentize the orthogonalized residuals.  The matrix
has one row for each observation in the data and as many columns as
there are formulas specified in the <code>model</code> argument.  The first
column of the matrix has names for the observations, and the remaining
columns contain the weights.  Each of the latter columns has a name
derived from the name of one of the count variables named in the
<code>model</code> argument.  If <code>count1</code> is the name of the count
variable used in the first formula, then the second column in the matrix
is named <code>Hdiag:count1</code>, etc.
<br>
If an observation has negative values specified for some outcome variables,
indicating that those outcome alternatives are not available for that
observation, then values of 0 appear in the weights matrix for that
observation, as many 0 values as there are unavailable alternatives.  Values
of 0 that are created for this reason will be the last values in the affected
row of the weights matrix, regardless of which outcome alternatives were
unavailable for the observation.</td></tr>
<tr valign="top"><td><code>prob</code></td>
<td>
The matrix of predicted probabilities for each category for each
observation based on the tanh coefficient estimates.</td></tr>
<tr valign="top"><td><code>residuals.rotate</code></td>
<td>
Matrix of studentized residuals which have been made comparable by
rotating each choice category to the first position.  These
residuals, unlike the student and standard residuals below, are no
longer orthogonalized because of the rotation.  These are the
residuals displayed in Table 6 of the reference article.</td></tr>
<tr valign="top"><td><code>residuals.student</code></td>
<td>
Matrix of fully studentized orthogonalized residuals.</td></tr>
<tr valign="top"><td><code>residuals.standard</code></td>
<td>
Matrix of orthogonalized residuals, standardized by dividing by the
overdispersion scale.</td></tr>
<tr valign="top"><td><code>mnl</code></td>
<td>
List of nonrobust maximum likelihood estimation results from function
<code>multinomMLE</code>.</td></tr>
<tr valign="top"><td><code>multinomT</code></td>
<td>
List of multinomial multivariate-t estimation results from function
<code>multinomT</code>.</td></tr>
<tr valign="top"><td><code>genoud</code></td>
<td>
List of LQD estimation results obtained by rgenoud optimization, from
function <code>genoudRob</code>.</td></tr>
<tr valign="top"><td><code>mtanh</code></td>
<td>
List of tanh estimation results from function <code>mGNtanh</code>.</td></tr>
<tr valign="top"><td><code>error</code></td>
<td>
Exit error code, usually from function <code>mGNtanh</code>.</td></tr>
<tr valign="top"><td><code>iter</code></td>
<td>
Number of LQD-tanh iterations.</td></tr>
</table>

<h3>Author(s)</h3>

<p>
Walter R. Mebane, Jr., Cornell University,
<a href="mailto:wrm1@cornell.edu">wrm1@cornell.edu</a>, <a href="http://macht.arts.cornell.edu/wrm1/">http://macht.arts.cornell.edu/wrm1/</a> <br>
</p>
<p>
Jasjeet S. Sekhon, Harvard University, <a href="mailto:jasjeet_sekhon@harvard.edu">jasjeet_sekhon@harvard.edu</a>,
<a href="http://jsekhon.fas.harvard.edu/">http://jsekhon.fas.harvard.edu/</a>
</p>


<h3>References</h3>

<p>
Walter R. Mebane, Jr. and  Jasjeet Singh Sekhon. 2004.  ``Robust Estimation
and Outlier Detection for Overdispersed Multinomial Models of Count Data.'' 
<em>American Journal of Political Science</em> 48 (April): 391&#150;410 .
<a href="http://macht.arts.cornell.edu/wrm1/multinom.pdf">http://macht.arts.cornell.edu/wrm1/multinom.pdf</a>
</p>
<p>
For the most current code and related material see
<a href="http://jsekhon.fas.harvard.edu/robust/">http://jsekhon.fas.harvard.edu/robust/</a>
</p>


<h3>Examples</h3>

<pre>
# make some multinomial data
x1 &lt;- rnorm(50);
x2 &lt;- rnorm(50);
p1 &lt;- exp(x1)/(1+exp(x1)+exp(x2));
p2 &lt;- exp(x2)/(1+exp(x1)+exp(x2));
p3 &lt;- 1 - (p1 + p2);
y &lt;- matrix(0, 50, 3);
for (i in 1:50) {
  y[i,] &lt;- rmultinomial(1000, c(p1[i], p2[i], p3[i]));
}

# perturb the first 5 observations
y[1:5,c(1,2,3)] &lt;- y[1:5,c(3,1,2)];
y1 &lt;- y[,1];
y2 &lt;- y[,2];
y3 &lt;- y[,3];

# put data into a dataframe
dtf &lt;- data.frame(x1, x2, y1, y2, y3);

## Set parameters for Genoud
zz.genoud.parms &lt;- list( pop.size             = 1000,
                        wait.generations      = 10,
                        max.generations       = 100,
                        scale.domains         = 5,
                        print.level = 0
                        )

# estimate a model, with "y3" being the reference category
# true coefficient values are:  (Intercept) = 0, x = 1
# impose an equality constraint
# equality constraint:  coefficients of x1 and x2 are equal
mulrobE &lt;- multinomRob(list(y1 ~ x1, y2 ~ x2, y3 ~ 0),
                      dtf,
                      equality = list(list(y1 ~ x1 + 0, y2 ~ x2 + 0)),
                      genoud.parms = zz.genoud.parms,
                      print.level = 3, iter=TRUE);
summary(mulrobE, weights=TRUE);
</pre>

<hr><div align="center"><a href="http://jsekhon.fas.harvard.edu/robust/">Return to Jasjeet
Sekhon's Robust Estimation Page</a></div>

</body></html>
